# 概要
beatmania IIDX INFINITAS専用の打鍵カウンタです。

SP,DPのどちらにも対応しています。  
コントローラからの入力ではなく、画面上のEXスコアを取得する方式を取っています。  
あらかじめ設定した目標スコアレートをもとに、EXスコアから叩いたノーツ数を推定します。

HTMLでリアルタイム表示するためのIFを備えており、OBSでの配信で使いやすくなっています。

# 本ツールのメリット
## SP,DPの両方に対応
本ツールはDPでも使えます。  
また、1P/2P/DPを自動判別する仕様のため、1日にSP/DPを両方やる人にも対応できます。

## 曲中以外(選曲画面など)での打鍵をカウントしない
EXスコアベースなので、選曲画面で迷子になる人や空打ちの多い人も安心です。  
1日の目標をEXスコアベースにするのも良いかもしれません。

## OBSでの配信で使いやすい
OBSのブラウザソースで読み込めるhtmlを同梱しているため、配信のたびに適切な位置にウィンドウを移動する作業が不要です。  
(INFINITASで使っているモニタ内にあるウィンドウはOBSで拾えない)

また、HTMLなので表示部分の見た目をCSSによって自由にカスタマイズできます。  
(以下にCSSのサンプルも記載しています)

# インストール方法
パッケージ(.zip)をダウンロードし、好きなフォルダに解凍してください。

# 使い方
## notes_counter.exeの使い方
1. notes_counter.exeを起動する。
2. INFINITASで使うモニタの位置を設定する。(一番左のモニタの左上を(0,0)としてsx,syに設定)
3. 目標とするスコアレートを設定する。1日の平均スコアレートを入れるのが良いと思います。スコアレートが高いほどEXスコアに対する推定ノーツ数が低くなります。
4. startをクリックする。
5. INFINITASをプレーする。

### ゲーム画面位置の設定について
正しいモニタが設定されているかの確認のために、Testボタンが使えます。  

Testボタンを押すと、設定された左上座標から1280×720だけ切り取った画像をtest.pngに保存します。  
test.pngを見て正しいモニタから取得できていることを確認してください。

作者の環境(2560×1440のモニタ3枚が横に並んでいて、真ん中のモニタでプレイしている)では、```sx:2560, sy:0```を設定します。

### その他
設定ファイル(settings.json)がない場合は起動時に生成されます。  

スコア取得開始後はdata.xmlにデータが逐次書き込まれます。

notes_counter.exe起動のたびにカウント数はリセットされます。(今後変更の可能性あり)

(わかる人向け)ソースコードから実行する場合は、Windows版Python3をインストールし、  
```$ pip install pyautogui PySimpleGUI numpy keyboard```  
のように必要なパッケージをインストールしてからnotes_counter.pywをダブルクリックしてください。

## OBSへの設定方法
1. ソースの追加 -> ブラウザを選択する。好きな名前を付けてOK。
2. 1.で作成したブラウザソースをダブルクリックする。
3. ローカルファイルのチェックを入れ、同梱のautoload.htmlを選択する。
4. 幅1200、高さ600ぐらいに設定する。(Alt+ドラッグでトリミングできるので小さすぎなければ適当で良いです)
5. 必要に応じて以下のようなカスタムCSSを設定する。

```
body { 

background-color: rgba(0, 0, 50, 0.8);
margin: 10px;
padding: 20px;
overflow: hidden;
font-family:"Meiryo";
color:#2196F3;   
font-size: 64px;
color: #fff;
text-shadow: 6px 6px 0 #000,
             -2px 2px 0 #000,
             2px -2px 0 #000,
             -2px -2px 0 #000;

}
```

# ライセンス
Apache License 2.0に準じるものとします。

# 連絡先
Twitter: @cold_planet_
