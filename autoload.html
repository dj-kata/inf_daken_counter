<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>Google Charts</title>
    <!--参考:https://rinsaka.com/google-charts/02-bar.html-->
    <style>
    body { 
    background-color: rbga(0,0,0,0.8);
    overflow: hidden;
    font-family:"Meiryo";
    color: #fff;
    font-size: 64px;
        text-shadow:
                1px 1px 1px #000, -1px -1px 1px #000,
               -1px 1px 1px #000,  1px -1px 1px #000,
                1px 1px 1px #000, -1px -1px 1px #000,
                1px 1px 1px #000,  1px -1px 1px #000;
        margin: 0;
    }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart','bar'], 'language': 'ja'});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
      	var pg = 0;
      	var gr = 0;
      	var gd = 0;
      	var bd = 0;
      	var pr = 0;
      	var cb = 0;
        var ran = 0;

      	var getxml = $.ajax({
      		url: "data.xml",
      		type: 'GET',
      		dataType: 'xml',
      		cache: false
      		});
        
      	getxml.done(function(xml){
      		pg = Number($(xml).find('pg').text());
      		gr = Number($(xml).find('gr').text());
      		gd = Number($(xml).find('gd').text());
      		bd = Number($(xml).find('bd').text());
      		pr = Number($(xml).find('pr').text());
      		cb = Number($(xml).find('cb').text());
      		ran = Number($(xml).find('notes_ran').text());
          xmax = (Math.floor((pg+gr+gd)/25000)+1)*25000;
		      playcount    = Number($(xml).find('playcount').text());
		      cur_notes    = Number($(xml).find('cur_notes').text());
		      today_notes  = Number($(xml).find('today_notes').text());
		      notes_ran    = Number($(xml).find('notes_ran').text());
		      notes_battle = Number($(xml).find('notes_battle').text());
		      score_rate   = $(xml).find('score_rate').text();
		      $('#playcount span').text(playcount.toLocaleString());
		      $('#cur_notes span').text(cur_notes.toLocaleString());
		      $('#today_notes span').text(today_notes.toLocaleString());
		      $('#notes_ran span').text(notes_ran.toLocaleString());
		      $('#notes_battle span').text(notes_battle.toLocaleString());
		      $('#score_rate span').text(score_rate);
          var data = google.visualization.arrayToDataTable([
            ['pr', 'ran', 'gd', 'gr', 'pg', { role: 'annotation' } ],
            ['today', 0, gd, gr, pg, pr+bd+gd+gr+pg],
          ]);
          var options = {
                  width: 600,
                  height: 200,
                  legend: { position: 'none'},
                  bar: { groupWidth: '80%' },
                  isStacked: true,
                  backgroundColor: "#000000",
                  series: {
                    0:{color:'#DD4445'},
                    1:{color:'#77FF00'},
                    2:{color:'#FFBB00'},
                    3:{color:'#00AAFF'}
                  },
                  annotations: {
                       textStyle: {
                           color: 'white',
                           fontSize: 32,
                       },
                       alwaysOutside: true
                  },
                  hAxis : { 
                    textStyle : {fontSize: 30, color:'#FFFFFF'},
                    format: '#,###',minValue:0,maxValue:xmax,gridlines: {count:4},ticks:[0,xmax]
                  },
                  vAxis : { 
                    textStyle : {fontSize: 30, color:'#FFFFFF'},
                  },
          };
          // Instantiate and draw our chart, passing in some options.
          var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
          chart.draw(data, options);
      	});
      
      	getxml.fail(function(error){
      		//alert("読み込み失敗");
      	});
	
      }

    window.addEventListener('DOMContentLoaded', function() {
	    var roopTimer = setInterval(drawChart, 100);
    });
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div id="playcount">plays: <span></span></div>
    <div id="cur_notes"><span></span> notes</div>
    <div id="today_notes">(本日: <span></span> notes)</div>
    <div id="score_rate">スコアレート:<span></span> %</div>
    <div id="chart_div"></div>
  </body>
</html>